<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Delivery App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #6B46C1 0%, #553C9A 50%, #44337A 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .input-focus:focus {
            border-color: #9F7AEA;
            box-shadow: 0 0 0 3px rgba(159, 122, 234, 0.3);
        }
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">
    <div id="login-container" class="w-full max-w-md">
        <!-- Login Card -->
        <div class="bg-white rounded-lg card-shadow overflow-hidden">
            <div class="p-8">
                <div class="flex justify-center mb-6">
                    <img src="https://placehold.co/200x50" alt="Logo do Delivery App" class="h-12">
                </div>
                
                <!-- Login Form -->
                <form id="loginForm" class="space-y-6">
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-700">Telefone</label>
                        <div class="mt-1 relative rounded-md shadow-sm">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-gray-500 sm:text-sm">+55</span>
                            </div>
                            <input type="tel" name="phone" id="phone" required
                                class="input-focus py-2 pl-12 pr-3 block w-full border border-gray-300 rounded-md leading-5 focus:outline-none placeholder-gray-400 sm:text-sm"
                                placeholder="(99) 99999-9999" inputmode="numeric" pattern="[0-9]{11}">
                        </div>
                    </div>

                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700">Senha</label>
                        <div class="mt-1">
                            <input id="password" name="password" type="password" required
                                class="input-focus py-2 px-3 block w-full border border-gray-300 rounded-md leading-5 focus:outline-none placeholder-gray-400 sm:text-sm"
                                placeholder="********">
                        </div>
                    </div>

                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <input id="remember-me" name="remember-me" type="checkbox"
                                class="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded">
                            <label for="remember-me" class="ml-2 block text-sm text-gray-700">Lembre de mim</label>
                        </div>

                        <div class="text-sm">
                            <a href="#" class="font-medium text-purple-600 hover:text-purple-500" onclick="showForgotPassword()">
                                Esqueceu sua senha?
                            </a>
                        </div>
                    </div>

                    <div>
                        <button type="submit" id="loginBtn"
                            class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors">
                            Entrar
                        </button>
                    </div>
                </form>

                <div class="mt-6">
                    <div class="relative">
                        <div class="absolute inset-0 flex items-center">
                            <div class="w-full border-t border-gray-300"></div>
                        </div>
                        <div class="relative flex justify-center text-sm">
                            <span class="px-2 bg-white text-gray-500">Ou</span>
                        </div>
                    </div>

                    <div class="mt-6">
                        <button onclick="showRegisterForm()"
                            class="w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors">
                            Criar nova conta
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Registration Modal -->
    <div id="registerModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Criar nova conta</h3>
                <div class="mt-2 px-7 py-3">
                    <form id="registerForm" class="space-y-4">
                        <div>
                            <label for="registerName" class="block text-left text-sm font-medium text-gray-700">Nome completo</label>
                            <input type="text" id="registerName" required
                                class="mt-1 input-focus py-2 px-3 block w-full border border-gray-300 rounded-md leading-5 focus:outline-none placeholder-gray-400 sm:text-sm"
                                placeholder="Seu nome">
                        </div>
                        <div>
                            <label for="registerPhone" class="block text-left text-sm font-medium text-gray-700">Telefone</label>
                            <div class="mt-1 relative rounded-md shadow-sm">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <span class="text-gray-500 sm:text-sm">+55</span>
                                </div>
                                <input type="tel" id="registerPhone" required
                                    class="input-focus py-2 pl-12 pr-3 block w-full border border-gray-300 rounded-md leading-5 focus:outline-none placeholder-gray-400 sm:text-sm"
                                    placeholder="(99) 99999-9999" inputmode="numeric" pattern="[0-9]{11}">
                            </div>
                        </div>
                        <div>
                            <label for="registerEmail" class="block text-left text-sm font-medium text-gray-700">E-mail (opcional)</label>
                            <input type="email" id="registerEmail"
                                class="mt-1 input-focus py-2 px-3 block w-full border border-gray-300 rounded-md leading-5 focus:outline-none placeholder-gray-400 sm:text-sm"
                                placeholder="seu@email.com">
                        </div>
                        <div>
                            <label for="registerPassword" class="block text-left text-sm font-medium text-gray-700">Senha</label>
                            <input type="password" id="registerPassword" required
                                class="mt-1 input-focus py-2 px-3 block w-full border border-gray-300 rounded-md leading-5 focus:outline-none placeholder-gray-400 sm:text-sm"
                                placeholder="********" minlength="6">
                        </div>
                    </form>
                </div>
                <div class="flex items-center justify-between px-4 py-3">
                    <button onclick="hideRegisterForm()"
                        class="px-4 py-2 bg-gray-200 text-gray-800 text-sm font-medium rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                        Cancelar
                    </button>
                    <button onclick="registerUser()"
                        class="px-4 py-2 bg-purple-600 text-white text-sm font-medium rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
                        Registrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Verification Modal -->
    <div id="verificationModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Verificação por WhatsApp</h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-500">Enviamos um código de verificação para o número informado. Digite o código recebido abaixo:</p>
                    <div class="mt-4">
                        <input type="text" id="verificationCode" maxlength="6" pattern="[0-9]{6}"
                            class="input-focus py-2 px-3 block w-full border border-gray-300 rounded-md leading-5 focus:outline-none placeholder-gray-400 sm:text-sm text-center tracking-widest text-xl"
                            placeholder="000000">
                    </div>
                </div>
                <div class="flex items-center justify-between px-4 py-3">
                    <button onclick="hideVerificationModal()"
                        class="px-4 py-2 bg-gray-200 text-gray-800 text-sm font-medium rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                        Cancelar
                    </button>
                    <button onclick="verifyCode()"
                        class="px-4 py-2 bg-purple-600 text-white text-sm font-medium rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
                        Verificar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Page -->
    <div id="profilePage" class="hidden w-full max-w-4xl mx-auto">
        <div class="bg-white rounded-lg card-shadow overflow-hidden">
            <div class="p-8">
                <div class="flex justify-between items-center mb-8">
                    <h1 class="text-2xl font-bold text-gray-800">Meu Perfil</h1>
                    <button onclick="logout()"
                        class="px-4 py-2 bg-gray-200 text-gray-800 text-sm font-medium rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                        Sair
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- User Info -->
                    <div class="col-span-1">
                        <div class="bg-gray-50 rounded-lg p-6">
                            <div class="flex flex-col items-center">
                                <div class="bg-purple-100 p-4 rounded-full mb-4">
                                    <img src="https://placehold.co/100x100" alt="Ícone de perfil do usuário" class="w-16 h-16 rounded-full">
                                </div>
                                <h2 id="profileName" class="text-xl font-semibold text-gray-800 mb-1">Nome do Usuário</h2>
                                <p id="profilePhone" class="text-sm text-gray-500 mb-4">(00) 00000-0000</p>
                                <p id="profileEmail" class="text-sm text-gray-500">usuario@exemplo.com</p>
                            </div>
                        </div>
                    </div>

                    <!-- Address and Orders -->
                    <div class="col-span-2">
                        <div class="space-y-6">
                            <!-- Address Section -->
                            <div class="bg-gray-50 rounded-lg p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-800">Endereço de Entrega</h3>
                                    <button onclick="editAddress()"
                                        class="text-sm text-purple-600 hover:text-purple-700 focus:outline-none">
                                        Editar
                                    </button>
                                </div>
                                <div id="addressInfo" class="text-gray-700">
                                    <p id="addressStreet" class="mb-1">Rua: Exemplo, 123</p>
                                    <p id="addressComplement" class="mb-1">Complemento: Apt 101</p>
                                    <p id="addressDistrict" class="mb-1">Bairro: Centro</p>
                                    <p id="addressCity" class="mb-1">Cidade: São Paulo - SP</p>
                                    <p id="addressZipcode" class="mb-1">CEP: 01000-000</p>
                                </div>
                                <div id="addressForm" class="hidden mt-4 space-y-3">
                                    <input type="text" id="inputStreet" placeholder="Rua, Número" class="w-full input-focus py-2 px-3 border border-gray-300 rounded-md">
                                    <input type="text" id="inputComplement" placeholder="Complemento" class="w-full input-focus py-2 px-3 border border-gray-300 rounded-md">
                                    <input type="text" id="inputDistrict" placeholder="Bairro" class="w-full input-focus py-2 px-3 border border-gray-300 rounded-md">
                                    <input type="text" id="inputCity" placeholder="Cidade" class="w-full input-focus py-2 px-3 border border-gray-300 rounded-md">
                                    <input type="text" id="inputState" placeholder="Estado" class="w-full input-focus py-2 px-3 border border-gray-300 rounded-md">
                                    <input type="text" id="inputZipcode" placeholder="CEP" class="w-full input-focus py-2 px-3 border border-gray-300 rounded-md">
                                    <div class="flex justify-end space-x-2 mt-2">
                                        <button onclick="cancelEditAddress()" class="px-3 py-1 text-sm text-gray-600 hover:bg-gray-100 rounded">Cancelar</button>
                                        <button onclick="saveAddress()" class="px-3 py-1 text-sm bg-purple-600 text-white rounded hover:bg-purple-700">Salvar</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Order History -->
                            <div class="bg-gray-50 rounded-lg p-6">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">Histórico de Pedidos</h3>
                                <div id="orderHistory" class="space-y-4">
                                    <!-- Sample order - will be populated dynamically -->
                                    <div class="border-b border-gray-200 pb-4">
                                        <div class="flex justify-between items-center mb-2">
                                            <p class="font-medium">Pedido #12345</p>
                                            <p class="text-sm text-gray-500">01/01/2023</p>
                                        </div>
                                        <p class="text-sm mb-2">Restaurante: Burguer King</p>
                                        <div class="flex justify-between">
                                            <p class="text-sm">2x Sanduíche, 1x Batata</p>
                                            <p class="font-medium">R$ 37,90</p>
                                        </div>
                                    </div>
                                    <div class="border-b border-gray-200 pb-4">
                                        <div class="flex justify-between items-center mb-2">
                                            <p class="font-medium">Pedido #12344</p>
                                            <p class="text-sm text-gray-500">31/12/2022</p>
                                        </div>
                                        <p class="text-sm mb-2">Restaurante: Pizza Hut</p>
                                        <div class="flex justify-between">
                                            <p class="text-sm">1x Pizza Grande, 2x Refrigerante</p>
                                            <p class="font-medium">R$ 69,90</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API configuration
        const API_URL = 'https://api-production-554a.up.railway.app'; // Change to your API URL

        // Current user data
        let currentUser = null;
        let verificationCode = '';

        // DOM Elements
        const loginContainer = document.getElementById('login-container');
        const loginForm = document.getElementById('loginForm');
        const registerModal = document.getElementById('registerModal');
        const verificationModal = document.getElementById('verificationModal');
        const profilePage = document.getElementById('profilePage');
        const registerForm = document.getElementById('registerForm');
        const verificationCodeInput = document.getElementById('verificationCode');

        // Show registration form
        function showRegisterForm() {
            registerModal.classList.remove('hidden');
        }

        // Hide registration form
        function hideRegisterForm() {
            registerModal.classList.add('hidden');
            registerForm.reset();
        }

        // Show verification modal
        function showVerificationModal(code) {
            verificationCode = code;
            verificationModal.classList.remove('hidden');
            verificationCodeInput.value = '';
        }

        // Hide verification modal
        function hideVerificationModal() {
            verificationModal.classList.add('hidden');
        }

        // Register new user
        async function registerUser() {
            const name = document.getElementById('registerName').value;
            let phone = document.getElementById('registerPhone').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;

            // Clean phone number
            phone = phone.replace(/\D/g, '');

            // Validate inputs
            if (!name || !phone || phone.length !== 11 || !password || password.length < 6) {
                alert('Por favor, preencha todos os campos corretamente!');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/usuarios`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        nome: name,
                        telefone: phone,
                        email: email || null
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Erro ao registrar usuário');
                }

                const user = await response.json();
                currentUser = user;

                // Generate verification code (6 digits)
                const code = Math.floor(100000 + Math.random() * 900000).toString();
                
                // In a real app, you would call your WhatsApp service here
                console.log(`Enviando código ${code} para o telefone ${phone}`);
                // await sendWhatsAppMessage(phone, `Seu código de verificação é: ${code}`);
                
                // Show verification modal (simulate WhatsApp sending)
                hideRegisterForm();
                showVerificationModal(code);
                
            } catch (error) {
                console.error('Registration error:', error);
                alert(`Erro ao registrar: ${error.message}`);
            }
        }

        // Verify code
        async function verifyCode() {
            const enteredCode = verificationCodeInput.value;
            
            if (enteredCode !== verificationCode) {
                verificationCodeInput.classList.add('shake');
                setTimeout(() => verificationCodeInput.classList.remove('shake'), 500);
                alert('Código inválido!');
                return;
            }

            // Mark user as verified
            try {
                const response = await fetch(`${API_URL}/usuarios/${currentUser.id}/verificar`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        codigo: verificationCode
                    })
                });

                if (!response.ok) {
                    throw new Error('Erro ao verificar usuário');
                }

                // Successful verification
                hideVerificationModal();
                loginUser(currentUser.telefone, 'password'); // You should store the password securely

            } catch (error) {
                console.error('Verification error:', error);
                alert('Erro ao verificar código');
            }
        }

        // Login user
        async function loginUser(phone, password) {
            try {
                // In a real app, you would call your login endpoint
                // This is a simulation for demonstration
                const response = await fetch(`${API_URL}/usuarios?telefone=${phone}`);
                
                if (!response.ok) {
                    throw new Error('Erro ao buscar usuário');
                }

                const users = await response.json();
                const user = users.find(u => u.telefone === phone);

                if (!user) {
                    throw new Error('Usuário não encontrado');
                }

                // In a real app, you would verify the password here
                currentUser = user;
                
                // Show profile page
                showProfilePage();
                
            } catch (error) {
                console.error('Login error:', error);
                alert(`Erro ao fazer login: ${error.message}`);
            }
        }

        // Show profile page
        function showProfilePage() {
            loginContainer.classList.add('hidden');
            profilePage.classList.remove('hidden');
            
            // Populate user data
            document.getElementById('profileName').textContent = currentUser.nome;
            document.getElementById('profilePhone').textContent = formatPhoneNumber(currentUser.telefone);
            document.getElementById('profileEmail').textContent = currentUser.email || 'Não informado';
            
            // For demo purposes, we're using fake data
            // In a real app, you would fetch this from your API
            document.getElementById('addressStreet').textContent = `Rua: Exemplo, 123`;
            document.getElementById('addressComplement').textContent = `Complemento: Apt 101`;
            document.getElementById('addressDistrict').textContent = `Bairro: Centro`;
            document.getElementById('addressCity').textContent = `Cidade: São Paulo - SP`;
            document.getElementById('addressZipcode').textContent = `CEP: 01000-000`;
            
            // Similarly, you would fetch real order history from your API
        }

        // Format phone number for display
        function formatPhoneNumber(phone) {
            if (!phone) return '';
            return `(${phone.substring(0, 2)}) ${phone.substring(2, 7)}-${phone.substring(7)}`;
        }

        // Logout
        function logout() {
            currentUser = null;
            profilePage.classList.add('hidden');
            loginContainer.classList.remove('hidden');
            loginForm.reset();
        }

        // Show forgot password form
        function showForgotPassword() {
            alert('Funcionalidade de recuperação de senha ainda não implementada.');
            // In a real app, you would implement password recovery logic here
        }

        // Form submit handlers
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const phone = document.getElementById('phone').value.replace(/\D/g, '');
            const password = document.getElementById('password').value;
            
            await loginUser(phone, password);
        });

        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            registerUser();
        });

        verificationCodeInput.addEventListener('input', (e) => {
            // Auto-verify when 6 digits are entered
            if (e.target.value.length === 6) {
                verifyCode();
            }
        });

        // Address editing functions
        function editAddress() {
            document.getElementById('addressInfo').classList.add('hidden');
            document.getElementById('addressForm').classList.remove('hidden');
            
            // Fill form with current values
            document.getElementById('inputStreet').value = document.getElementById('addressStreet').textContent.replace('Rua: ', '');
            document.getElementById('inputComplement').value = document.getElementById('addressComplement').textContent.replace('Complemento: ', '');
            document.getElementById('inputDistrict').value = document.getElementById('addressDistrict').textContent.replace('Bairro: ', '');
            document.getElementById('inputCity').value = document.getElementById('addressCity').textContent.split(' - ')[0].replace('Cidade: ', '');
            document.getElementById('inputState').value = document.getElementById('addressCity').textContent.split(' - ')[1] || '';
            document.getElementById('inputZipcode').value = document.getElementById('addressZipcode').textContent.replace('CEP: ', '');
        }

        function cancelEditAddress() {
            document.getElementById('addressInfo').classList.remove('hidden');
            document.getElementById('addressForm').classList.add('hidden');
        }

        function saveAddress() {
            const street = document.getElementById('inputStreet').value;
            const complement = document.getElementById('inputComplement').value;
            const district = document.getElementById('inputDistrict').value;
            const city = document.getElementById('inputCity').value;
            const state = document.getElementById('inputState').value;
            const zipcode = document.getElementById('inputZipcode').value;
            
            // Update displayed values
            document.getElementById('addressStreet').textContent = `Rua: ${street}`;
            document.getElementById('addressComplement').textContent = `Complemento: ${complement}`;
            document.getElementById('addressDistrict').textContent = `Bairro: ${district}`;
            document.getElementById('addressCity').textContent = `Cidade: ${city} - ${state}`;
            document.getElementById('addressZipcode').textContent = `CEP: ${zipcode}`;
            
            // In a real app, you would save this to your API here
            
            cancelEditAddress();
            alert('Endereço salvo com sucesso!');
        }
    </script>
</body>
</html>
